/**
 * KK Cabinets
 * @copyright (C) 2020 Luke Zhang, Ethan Lim
 * 
 * @author Luke Zhang, Ethan Lim
 * 
 * https://luke-zhang-04.github.io/
 * https://github.com/ethanlim04
 * 
 * @license GPL-3.0
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=!0;var _d=!1;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function(){};return{s:F,n:function n(){if(i>=o.length)return{done:!0};return{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e3){didErr=!0;err=_e3},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var storageRef=storage.ref("gallery");firebase.auth().onAuthStateChanged(function(user){if(user){get_recommendations(user)}});function get_recommendations(user){var recommended=new Map;var rated=new Map;firebase.database().ref("/users/"+user.uid+"/predicted").once("value").then(function(snapshot){var _iterator=_createForOfIteratorHelper(snapshot.val().entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2);index=_step$value[0];elem=_step$value[1];if(!Number.isInteger(elem)&&elem>=5){recommended[index]=elem}else if(Number.isInteger&&elem>=7){rated[index]=elem}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}).then(function(){display_setup(recommended,"recon");display_setup(rated,"rated")}).then(function(){document.getElementById("loading").style.display="none"})}function display_setup(data,config){var allData=new Map;db.collection("gallery").get().then(function(snapshot){snapshot.docs.forEach(function(doc){allData[doc.id]=doc.data()})}).then(function(){display_batch(data,allData,config)})}function display_batch(data,allData,row){var columns=document.getElementById(row).getElementsByClassName("responsive_column");var columnNum=0;var _loop=function(key){var imgURL=storageRef.child(allData[key]["file"]);var column=columns[columnNum%4];var id=key;imgURL.getDownloadURL().then(function(url){column.insertAdjacentHTML("beforeend","<div class=\"image_container\" id="+id+"><img onclick=\"expand("+id+")\"src=\""+url+"\"/></div>");var element=document.getElementById(id);var info="<br/>Colour: "+allData[id]["details"]["colour"].charAt(0).toUpperCase()+allData[id]["details"]["colour"].slice(1)+"<br/>Furniture: ";if(allData[id]["details"]["furniture"]["countertop"]&&allData[id]["details"]["furniture"]["cabinet"]){info+="Countertop and Cabinets "}else if(allData[id]["details"]["furniture"]["cabinet"]){info+="Cabinets"}else if(allData[id]["details"]["furniture"]["countertop"]){info+="Countertop"}info+="<br/>Location: "+allData[id]["details"]["location"].charAt(0).toUpperCase()+allData[id]["details"]["location"].slice(1);info+="<br/>Material: "+allData[id]["details"]["material"].charAt(0).toUpperCase()+allData[id]["details"]["material"].slice(1);info+="<br/>Pattern: "+(allData[id]["details"]["pattern"]?"Yes":"None");if(row=="recon"){info+="<br/>Estimated rating: "+data[id]}else if(row=="rated"){info+="<br/>Your rating: "+data[id]}element.insertAdjacentHTML("beforeend","<div class=\"details\"><p>"+info+"<p>")});columnNum++};for(var key in data){_loop(key)}if(Object.keys(data).length==0){if(row=="recon"){var header=document.getElementById("reconHeader");header.insertAdjacentHTML("afterend","<p class=\"noDisplay\">It looks like we couldn't get you a suitable recommendation. Please rate more items or wait as the program could still be processing your ratings.</p>")}else if(row=="rated"){var _header=document.getElementById("ratedHeader");_header.insertAdjacentHTML("afterend","<p class=\"noDisplay\">It looks like you haven't rated anything highly yet. Please rate more items. </p>")}}}function expand(key){var element=document.getElementById(key);var container=element.getElementsByClassName("details")[0];if(container.style.maxHeight){container.style.maxHeight=null}else{container.style.maxHeight=container.scrollHeight+"px"}}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2pzL3JlY29tbWVuZGF0aW9ucy5qcyJdLCJuYW1lcyI6WyJzdG9yYWdlUmVmIiwic3RvcmFnZSIsInJlZiIsImZpcmViYXNlIiwiYXV0aCIsIm9uQXV0aFN0YXRlQ2hhbmdlZCIsInVzZXIiLCJnZXRfcmVjb21tZW5kYXRpb25zIiwicmVjb21tZW5kZWQiLCJNYXAiLCJyYXRlZCIsImRhdGFiYXNlIiwidWlkIiwib25jZSIsInRoZW4iLCJzbmFwc2hvdCIsInZhbCIsImVudHJpZXMiLCJpbmRleCIsImVsZW0iLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJkaXNwbGF5X3NldHVwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiZGlzcGxheSIsImRhdGEiLCJjb25maWciLCJhbGxEYXRhIiwiZGIiLCJjb2xsZWN0aW9uIiwiZ2V0IiwiZG9jcyIsImZvckVhY2giLCJkb2MiLCJpZCIsImRpc3BsYXlfYmF0Y2giLCJyb3ciLCJjb2x1bW5zIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImNvbHVtbk51bSIsImtleSIsImltZ1VSTCIsImNoaWxkIiwiY29sdW1uIiwiZ2V0RG93bmxvYWRVUkwiLCJ1cmwiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJlbGVtZW50IiwiaW5mbyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiaGVhZGVyIiwiZXhwYW5kIiwiY29udGFpbmVyIiwibWF4SGVpZ2h0Iiwic2Nyb2xsSGVpZ2h0Il0sIm1hcHBpbmdzIjoiNG5FQW9CQSxHQUFJQSxDQUFBQSxVQUFVLENBQUdDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFNBQVosQ0FBakIsQ0FHQUMsUUFBUSxDQUFDQyxJQUFULEdBQWdCQyxrQkFBaEIsQ0FBbUMsU0FBU0MsSUFBVCxDQUFlLENBQzlDLEdBQUlBLElBQUosQ0FBVSxDQUNOQyxtQkFBbUIsQ0FBQ0QsSUFBRCxDQUN0QixDQUdKLENBTkQsRUFRQSxR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VUFESixDQUVJLDBHQUZKLENBSUgsQ0FDSixDQUNKLENBRUQsUUFBU1UsQ0FBQUEsTUFBVCxDQUFnQmhCLEdBQWhCLENBQXFCLENBQ2pCLEdBQUlPLENBQUFBLE9BQU8sQ0FBRzFCLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QmtCLEdBQXhCLENBQWQsQ0FDQSxHQUFJaUIsQ0FBQUEsU0FBUyxDQUFHVixPQUFPLENBQUNULHNCQUFSLENBQStCLFNBQS9CLEVBQTBDLENBQTFDLENBQWhCLENBQ0EsR0FBSW1CLFNBQVMsQ0FBQ2xDLEtBQVYsQ0FBZ0JtQyxTQUFwQixDQUE4QixDQUMxQkQsU0FBUyxDQUFDbEMsS0FBVixDQUFnQm1DLFNBQWhCLENBQTRCLElBQy9CLENBRkQsSUFFTyxDQUNIRCxTQUFTLENBQUNsQyxLQUFWLENBQWdCbUMsU0FBaEIsQ0FBNEJELFNBQVMsQ0FBQ0UsWUFBVixDQUF5QixJQUN4RCxDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBLSyBDYWJpbmV0c1xuICogQ29weXJpZ2h0IChDKSAyMDIwICBMdWtlIFpoYW5nLCBFdGhhbiBMaW1cbiAqIFxuICogaHR0cHM6Ly9sdWtlLXpoYW5nLTA0LmdpdGh1Yi5pb1xuICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGFubGltMDRcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKiBcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKiBcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG5sZXQgc3RvcmFnZVJlZiA9IHN0b3JhZ2UucmVmKFwiZ2FsbGVyeVwiKVxuXG4vL2F1dGggc3RhdGUgY2hhbmdlZFxuZmlyZWJhc2UuYXV0aCgpLm9uQXV0aFN0YXRlQ2hhbmdlZChmdW5jdGlvbih1c2VyKSB7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgICAgZ2V0X3JlY29tbWVuZGF0aW9ucyh1c2VyKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vIHVzZXIgaXMgc2lnbmVkIGluLlxuICAgIH1cbn0pXG5cbmZ1bmN0aW9uIGdldF9yZWNvbW1lbmRhdGlvbnModXNlcikge1xuICAgIGxldCByZWNvbW1lbmRlZCA9IG5ldyBNYXAoKVxuICAgIGxldCByYXRlZCA9IG5ldyBNYXAoKVxuICAgIGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKFwiL3VzZXJzL1wiICsgdXNlci51aWQgKyBcIi9wcmVkaWN0ZWRcIikub25jZShcInZhbHVlXCIpLnRoZW4oZnVuY3Rpb24oc25hcHNob3QpIHtcbiAgICAgICAgZm9yIChbaW5kZXgsIGVsZW1dIG9mIHNuYXBzaG90LnZhbCgpLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGVsZW0pICYmIGVsZW0gPj0gNSkge1xuICAgICAgICAgICAgICAgIHJlY29tbWVuZGVkW2luZGV4XSA9IGVsZW1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzSW50ZWdlciAmJiBlbGVtID49IDcpIHtcbiAgICAgICAgICAgICAgICByYXRlZFtpbmRleF0gPSBlbGVtXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KS50aGVuKF8gPT4ge1xuICAgICAgICBkaXNwbGF5X3NldHVwKHJlY29tbWVuZGVkLCBcInJlY29uXCIpXG4gICAgICAgIGRpc3BsYXlfc2V0dXAocmF0ZWQsIFwicmF0ZWRcIilcbiAgICB9KSAudGhlbihfID0+IHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2FkaW5nXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGRpc3BsYXlfc2V0dXAoZGF0YSwgY29uZmlnKSB7XG4gICAgbGV0IGFsbERhdGEgPSBuZXcgTWFwKClcbiAgICBkYi5jb2xsZWN0aW9uKFwiZ2FsbGVyeVwiKS5nZXQoKS50aGVuKChzbmFwc2hvdCkgPT4ge1xuICAgICAgICBzbmFwc2hvdC5kb2NzLmZvckVhY2goZG9jID0+IHtcbiAgICAgICAgICAgIGFsbERhdGFbZG9jLmlkXSA9IGRvYy5kYXRhKClcbiAgICAgICAgfSlcbiAgICB9KS50aGVuKF8gPT4ge1xuICAgICAgICBkaXNwbGF5X2JhdGNoKGRhdGEsIGFsbERhdGEsIGNvbmZpZylcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBkaXNwbGF5X2JhdGNoKGRhdGEsIGFsbERhdGEsIHJvdykge1xuICAgIGxldCBjb2x1bW5zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm93KS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicmVzcG9uc2l2ZV9jb2x1bW5cIilcbiAgICBsZXQgY29sdW1uTnVtID0gMFxuXG4gICAgZm9yIChsZXQga2V5IGluIGRhdGEpIHtcbiAgICAgICAgbGV0IGltZ1VSTCA9IHN0b3JhZ2VSZWYuY2hpbGQoYWxsRGF0YVtrZXldW1wiZmlsZVwiXSkgLy9pbWFnZSB1cmxcbiAgICAgICAgbGV0IGNvbHVtbiA9IGNvbHVtbnNbY29sdW1uTnVtJTRdXG4gICAgICAgIGxldCBpZCA9IGtleVxuXG4gICAgICAgIGltZ1VSTC5nZXREb3dubG9hZFVSTCgpLnRoZW4oZnVuY3Rpb24odXJsKSB7XG4gICAgICAgICAgICAvL2FwcGVuZCBpbWFnZSB0byBjb2x1bW5cbiAgICAgICAgICAgIGNvbHVtbi5pbnNlcnRBZGphY2VudEhUTUwgKCBcbiAgICAgICAgICAgICAgICBcImJlZm9yZWVuZFwiLFxuICAgICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz1cXFwiaW1hZ2VfY29udGFpbmVyXFxcIiBpZD1cIiArIGlkICsgXCI+PGltZyBvbmNsaWNrPVxcXCJleHBhbmQoXCIgKyBpZCArIFwiKVxcXCJzcmM9XFxcIlwiKyB1cmwgKyBcIlxcXCIvPjwvZGl2PlwiXG4gICAgICAgICAgICApXG5cbiAgICAgICAgICAgIC8vYXR0YWNoIGluZm9ybWF0aW9uIHRvIGltYWdlXG4gICAgICAgICAgICBsZXQgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSAvL3Nob3J0Y3V0IGZvciB0YXJnZXQgZWxlbWVudFxuICAgICAgICAgICAgLy92YXJpYWJsZSBmb3IgaW5mb3JtYXRpb25cbiAgICAgICAgICAgIGxldCBpbmZvID0gXCI8YnIvPkNvbG91cjogXCIgKyBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJjb2xvdXJcIl0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJjb2xvdXJcIl0uc2xpY2UoMSkgKyBcIjxici8+RnVybml0dXJlOiBcIlxuXG4gICAgICAgICAgICAvL2Z1cm5pdHVyZSB0eXBlXG4gICAgICAgICAgICBpZiAoYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wiZnVybml0dXJlXCJdW1wiY291bnRlcnRvcFwiXSAmJiBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJmdXJuaXR1cmVcIl1bXCJjYWJpbmV0XCJdKSB7XG4gICAgICAgICAgICAgICAgaW5mbyArPSBcIkNvdW50ZXJ0b3AgYW5kIENhYmluZXRzIFwiXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImZ1cm5pdHVyZVwiXVtcImNhYmluZXRcIl0pIHtcbiAgICAgICAgICAgICAgICBpbmZvICs9IFwiQ2FiaW5ldHNcIlxuICAgICAgICAgICAgfSBlbHNlIGlmIChhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJmdXJuaXR1cmVcIl1bXCJjb3VudGVydG9wXCJdKSB7XG4gICAgICAgICAgICAgICAgaW5mbyArPSBcIkNvdW50ZXJ0b3BcIlxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2xvY2F0aW9uXG4gICAgICAgICAgICBpbmZvICs9IFwiPGJyLz5Mb2NhdGlvbjogXCIgKyBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJsb2NhdGlvblwiXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImxvY2F0aW9uXCJdLnNsaWNlKDEpXG4gICAgICAgICAgICAvL21hdGVyaWFsXG4gICAgICAgICAgICBpbmZvICs9IFwiPGJyLz5NYXRlcmlhbDogXCIgKyBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJtYXRlcmlhbFwiXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcIm1hdGVyaWFsXCJdLnNsaWNlKDEpXG4gICAgICAgICAgICAvL3BhdHRlcm5cbiAgICAgICAgICAgIGluZm8gKz0gXCI8YnIvPlBhdHRlcm46IFwiICsgKGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcInBhdHRlcm5cIl0gPyBcIlllc1wiIDogXCJOb25lXCIpXG5cbiAgICAgICAgICAgIGlmIChyb3cgPT0gXCJyZWNvblwiKSB7XG4gICAgICAgICAgICAgICAgaW5mbyArPSBcIjxici8+RXN0aW1hdGVkIHJhdGluZzogXCIgKyBkYXRhW2lkXVxuICAgICAgICAgICAgfSBlbHNlIGlmIChyb3cgPT0gXCJyYXRlZFwiKSB7XG4gICAgICAgICAgICAgICAgaW5mbyArPSBcIjxici8+WW91ciByYXRpbmc6IFwiICsgZGF0YVtpZF1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwgKFxuICAgICAgICAgICAgICAgIFwiYmVmb3JlZW5kXCIsXG4gICAgICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPVxcXCJkZXRhaWxzXFxcIj48cD5cIiArIGluZm8gKyBcIjxwPlwiXG4gICAgICAgICAgICApXG4gICAgICAgIH0pXG4gICAgICAgIGNvbHVtbk51bSsrXG4gICAgfVxuXG4gICAgaWYgKE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIGlmIChyb3cgPT0gXCJyZWNvblwiKSB7XG4gICAgICAgICAgICBsZXQgaGVhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZWNvbkhlYWRlclwiKVxuICAgICAgICAgICAgaGVhZGVyLmluc2VydEFkamFjZW50SFRNTChcbiAgICAgICAgICAgICAgICBcImFmdGVyZW5kXCIsXG4gICAgICAgICAgICAgICAgXCI8cCBjbGFzcz1cXFwibm9EaXNwbGF5XFxcIj5JdCBsb29rcyBsaWtlIHdlIGNvdWxkbid0IGdldCB5b3UgYSBzdWl0YWJsZSByZWNvbW1lbmRhdGlvbi4gUGxlYXNlIHJhdGUgbW9yZSBpdGVtcyBvciB3YWl0IGFzIHRoZSBwcm9ncmFtIGNvdWxkIHN0aWxsIGJlIHByb2Nlc3NpbmcgeW91ciByYXRpbmdzLjwvcD5cIlxuICAgICAgICAgICAgKVxuICAgICAgICB9IGVsc2UgaWYgKHJvdyA9PSBcInJhdGVkXCIpIHtcbiAgICAgICAgICAgIGxldCBoZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhdGVkSGVhZGVyXCIpXG4gICAgICAgICAgICBoZWFkZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKFxuICAgICAgICAgICAgICAgIFwiYWZ0ZXJlbmRcIixcbiAgICAgICAgICAgICAgICBcIjxwIGNsYXNzPVxcXCJub0Rpc3BsYXlcXFwiPkl0IGxvb2tzIGxpa2UgeW91IGhhdmVuJ3QgcmF0ZWQgYW55dGhpbmcgaGlnaGx5IHlldC4gUGxlYXNlIHJhdGUgbW9yZSBpdGVtcy4gPC9wPlwiXG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGV4cGFuZChrZXkpIHtcbiAgICBsZXQgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGtleSlcbiAgICBsZXQgY29udGFpbmVyID0gZWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZGV0YWlsc1wiKVswXVxuICAgIGlmIChjb250YWluZXIuc3R5bGUubWF4SGVpZ2h0KXtcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLm1heEhlaWdodCA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLm1heEhlaWdodCA9IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQgKyBcInB4XCI7XG4gICAgfVxufSJdfQ==
