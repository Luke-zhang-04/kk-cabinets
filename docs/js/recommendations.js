"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=!0;var _d=!1;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function(){};return{s:F,n:function n(){if(i>=o.length)return{done:!0};return{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e3){didErr=!0;err=_e3},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}/**
 * KK Cabinets
 * @copyright 2020 Luke Zhang, Ethan Lim
 * @author luke zhang, Ethan Lim
 * 
 * https://luke-zhang-04.github.io
 * https://github.com/ethanlim04
 * 
 * @license
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */var storageRef=storage.ref("gallery");firebase.auth().onAuthStateChanged(function(user){if(user){get_recommendations(user)}});function get_recommendations(user){var recommended=new Map;var rated=new Map;firebase.database().ref("/users/"+user.uid+"/predicted").once("value").then(function(snapshot){var _iterator=_createForOfIteratorHelper(snapshot.val().entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2);index=_step$value[0];elem=_step$value[1];if(!Number.isInteger(elem)&&elem>=5){recommended[index]=elem}else if(Number.isInteger&&elem>=7){rated[index]=elem}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}).then(function(){display_setup(recommended,"recon");display_setup(rated,"rated")}).then(function(){document.getElementById("loading").style.display="none"})}function display_setup(data,config){var allData=new Map;db.collection("gallery").get().then(function(snapshot){snapshot.docs.forEach(function(doc){allData[doc.id]=doc.data()})}).then(function(){display_batch(data,allData,config)})}function display_batch(data,allData,row){var columns=document.getElementById(row).getElementsByClassName("responsive_column");var columnNum=0;var _loop=function(key){var imgURL=storageRef.child(allData[key]["file"]);var column=columns[columnNum%4];var id=key;imgURL.getDownloadURL().then(function(url){column.insertAdjacentHTML("beforeend","<div class=\"image_container\" id="+id+"><img onclick=\"expand("+id+")\"src=\""+url+"\"/></div>");var element=document.getElementById(id);var info="<br/>Colour: "+allData[id]["details"]["colour"].charAt(0).toUpperCase()+allData[id]["details"]["colour"].slice(1)+"<br/>Furniture: ";if(allData[id]["details"]["furniture"]["countertop"]&&allData[id]["details"]["furniture"]["cabinet"]){info+="Countertop and Cabinets "}else if(allData[id]["details"]["furniture"]["cabinet"]){info+="Cabinets"}else if(allData[id]["details"]["furniture"]["countertop"]){info+="Countertop"}info+="<br/>Location: "+allData[id]["details"]["location"].charAt(0).toUpperCase()+allData[id]["details"]["location"].slice(1);info+="<br/>Material: "+allData[id]["details"]["material"].charAt(0).toUpperCase()+allData[id]["details"]["material"].slice(1);info+="<br/>Pattern: "+(allData[id]["details"]["pattern"]?"Yes":"None");if(row=="recon"){info+="<br/>Estimated rating: "+data[id]}else if(row=="rated"){info+="<br/>Your rating: "+data[id]}element.insertAdjacentHTML("beforeend","<div class=\"details\"><p>"+info+"<p>")});columnNum++};for(var key in data){_loop(key)}if(Object.keys(data).length==0){if(row=="recon"){var header=document.getElementById("reconHeader");header.insertAdjacentHTML("afterend","<p class=\"noDisplay\">It looks like we couldn't get you a suitable recommendation. Please rate more items or wait as the program could still be processing your ratings.</p>")}else if(row=="rated"){var _header=document.getElementById("ratedHeader");_header.insertAdjacentHTML("afterend","<p class=\"noDisplay\">It looks like you haven't rated anything highly yet. Please rate more items. </p>")}}}function expand(key){var element=document.getElementById(key);var container=element.getElementsByClassName("details")[0];if(container.style.maxHeight){container.style.maxHeight=null}else{container.style.maxHeight=container.scrollHeight+"px"}}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZWNvbW1lbmRhdGlvbnMuanMiXSwibmFtZXMiOlsic3RvcmFnZVJlZiIsInN0b3JhZ2UiLCJyZWYiLCJmaXJlYmFzZSIsImF1dGgiLCJvbkF1dGhTdGF0ZUNoYW5nZWQiLCJ1c2VyIiwiZ2V0X3JlY29tbWVuZGF0aW9ucyIsInJlY29tbWVuZGVkIiwiTWFwIiwicmF0ZWQiLCJkYXRhYmFzZSIsInVpZCIsIm9uY2UiLCJ0aGVuIiwic25hcHNob3QiLCJ2YWwiLCJlbnRyaWVzIiwiaW5kZXgiLCJlbGVtIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwiZGlzcGxheV9zZXR1cCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImRpc3BsYXkiLCJkYXRhIiwiY29uZmlnIiwiYWxsRGF0YSIsImRiIiwiY29sbGVjdGlvbiIsImdldCIsImRvY3MiLCJmb3JFYWNoIiwiZG9jIiwiaWQiLCJkaXNwbGF5X2JhdGNoIiwicm93IiwiY29sdW1ucyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJjb2x1bW5OdW0iLCJrZXkiLCJpbWdVUkwiLCJjaGlsZCIsImNvbHVtbiIsImdldERvd25sb2FkVVJMIiwidXJsIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwiZWxlbWVudCIsImluZm8iLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsImhlYWRlciIsImV4cGFuZCIsImNvbnRhaW5lciIsIm1heEhlaWdodCIsInNjcm9sbEhlaWdodCJdLCJtYXBwaW5ncyI6IjRuRUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJBLEdBQUlBLENBQUFBLFVBQVUsQ0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVksU0FBWixDQUFqQixDQUdBQyxRQUFRLENBQUNDLElBQVQsR0FBZ0JDLGtCQUFoQixDQUFtQyxTQUFTQyxJQUFULENBQWUsQ0FDOUMsR0FBSUEsSUFBSixDQUFVLENBQ05DLG1CQUFtQixDQUFDRCxJ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QWlDLE9BQU0sQ0FBQ1Qsa0JBQVAsQ0FDSSxVQURKLENBRUksMEdBRkosQ0FJSCxDQUNKLENBQ0osQ0FFRCxRQUFTVSxDQUFBQSxNQUFULENBQWdCaEIsR0FBaEIsQ0FBcUIsQ0FDakIsR0FBSU8sQ0FBQUEsT0FBTyxDQUFHMUIsUUFBUSxDQUFDQyxjQUFULENBQXdCa0IsR0FBeEIsQ0FBZCxDQUNBLEdBQUlpQixDQUFBQSxTQUFTLENBQUdWLE9BQU8sQ0FBQ1Qsc0JBQVIsQ0FBK0IsU0FBL0IsRUFBMEMsQ0FBMUMsQ0FBaEIsQ0FDQSxHQUFJbUIsU0FBUyxDQUFDbEMsS0FBVixDQUFnQm1DLFNBQXBCLENBQThCLENBQzFCRCxTQUFTLENBQUNsQyxLQUFWLENBQWdCbUMsU0FBaEIsQ0FBNEIsSUFDL0IsQ0FGRCxJQUVPLENBQ0hELFNBQVMsQ0FBQ2xDLEtBQVYsQ0FBZ0JtQyxTQUFoQixDQUE0QkQsU0FBUyxDQUFDRSxZQUFWLENBQXlCLElBQ3hELENBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEtLIENhYmluZXRzXG4gKiBAY29weXJpZ2h0IDIwMjAgTHVrZSBaaGFuZywgRXRoYW4gTGltXG4gKiBAYXV0aG9yIGx1a2UgemhhbmcsIEV0aGFuIExpbVxuICogXG4gKiBodHRwczovL2x1a2UtemhhbmctMDQuZ2l0aHViLmlvXG4gKiBodHRwczovL2dpdGh1Yi5jb20vZXRoYW5saW0wNFxuICogXG4gKiBAbGljZW5zZVxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqIFxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqIFxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbmxldCBzdG9yYWdlUmVmID0gc3RvcmFnZS5yZWYoXCJnYWxsZXJ5XCIpXG5cbi8vYXV0aCBzdGF0ZSBjaGFuZ2VkXG5maXJlYmFzZS5hdXRoKCkub25BdXRoU3RhdGVDaGFuZ2VkKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICBpZiAodXNlcikge1xuICAgICAgICBnZXRfcmVjb21tZW5kYXRpb25zKHVzZXIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTm8gdXNlciBpcyBzaWduZWQgaW4uXG4gICAgfVxufSlcblxuZnVuY3Rpb24gZ2V0X3JlY29tbWVuZGF0aW9ucyh1c2VyKSB7XG4gICAgbGV0IHJlY29tbWVuZGVkID0gbmV3IE1hcCgpXG4gICAgbGV0IHJhdGVkID0gbmV3IE1hcCgpXG4gICAgZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYoXCIvdXNlcnMvXCIgKyB1c2VyLnVpZCArIFwiL3ByZWRpY3RlZFwiKS5vbmNlKFwidmFsdWVcIikudGhlbihmdW5jdGlvbihzbmFwc2hvdCkge1xuICAgICAgICBmb3IgKFtpbmRleCwgZWxlbV0gb2Ygc25hcHNob3QudmFsKCkuZW50cmllcygpKSB7XG4gICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZWxlbSkgJiYgZWxlbSA+PSA1KSB7XG4gICAgICAgICAgICAgICAgcmVjb21tZW5kZWRbaW5kZXhdID0gZWxlbVxuICAgICAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNJbnRlZ2VyICYmIGVsZW0gPj0gNykge1xuICAgICAgICAgICAgICAgIHJhdGVkW2luZGV4XSA9IGVsZW1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pLnRoZW4oXyA9PiB7XG4gICAgICAgIGRpc3BsYXlfc2V0dXAocmVjb21tZW5kZWQsIFwicmVjb25cIilcbiAgICAgICAgZGlzcGxheV9zZXR1cChyYXRlZCwgXCJyYXRlZFwiKVxuICAgIH0pIC50aGVuKF8gPT4ge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvYWRpbmdcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiXG4gICAgfSlcbn1cblxuZnVuY3Rpb24gZGlzcGxheV9zZXR1cChkYXRhLCBjb25maWcpIHtcbiAgICBsZXQgYWxsRGF0YSA9IG5ldyBNYXAoKVxuICAgIGRiLmNvbGxlY3Rpb24oXCJnYWxsZXJ5XCIpLmdldCgpLnRoZW4oKHNuYXBzaG90KSA9PiB7XG4gICAgICAgIHNuYXBzaG90LmRvY3MuZm9yRWFjaChkb2MgPT4ge1xuICAgICAgICAgICAgYWxsRGF0YVtkb2MuaWRdID0gZG9jLmRhdGEoKVxuICAgICAgICB9KVxuICAgIH0pLnRoZW4oXyA9PiB7XG4gICAgICAgIGRpc3BsYXlfYmF0Y2goZGF0YSwgYWxsRGF0YSwgY29uZmlnKVxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGRpc3BsYXlfYmF0Y2goZGF0YSwgYWxsRGF0YSwgcm93KSB7XG4gICAgbGV0IGNvbHVtbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyb3cpLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJyZXNwb25zaXZlX2NvbHVtblwiKVxuICAgIGxldCBjb2x1bW5OdW0gPSAwXG5cbiAgICBmb3IgKGxldCBrZXkgaW4gZGF0YSkge1xuICAgICAgICBsZXQgaW1nVVJMID0gc3RvcmFnZVJlZi5jaGlsZChhbGxEYXRhW2tleV1bXCJmaWxlXCJdKSAvL2ltYWdlIHVybFxuICAgICAgICBsZXQgY29sdW1uID0gY29sdW1uc1tjb2x1bW5OdW0lNF1cbiAgICAgICAgbGV0IGlkID0ga2V5XG5cbiAgICAgICAgaW1nVVJMLmdldERvd25sb2FkVVJMKCkudGhlbihmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgICAgIC8vYXBwZW5kIGltYWdlIHRvIGNvbHVtblxuICAgICAgICAgICAgY29sdW1uLmluc2VydEFkamFjZW50SFRNTCAoIFxuICAgICAgICAgICAgICAgIFwiYmVmb3JlZW5kXCIsXG4gICAgICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPVxcXCJpbWFnZV9jb250YWluZXJcXFwiIGlkPVwiICsgaWQgKyBcIj48aW1nIG9uY2xpY2s9XFxcImV4cGFuZChcIiArIGlkICsgXCIpXFxcInNyYz1cXFwiXCIrIHVybCArIFwiXFxcIi8+PC9kaXY+XCJcbiAgICAgICAgICAgIClcblxuICAgICAgICAgICAgLy9hdHRhY2ggaW5mb3JtYXRpb24gdG8gaW1hZ2VcbiAgICAgICAgICAgIGxldCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpIC8vc2hvcnRjdXQgZm9yIHRhcmdldCBlbGVtZW50XG4gICAgICAgICAgICAvL3ZhcmlhYmxlIGZvciBpbmZvcm1hdGlvblxuICAgICAgICAgICAgbGV0IGluZm8gPSBcIjxici8+Q29sb3VyOiBcIiArIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImNvbG91clwiXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImNvbG91clwiXS5zbGljZSgxKSArIFwiPGJyLz5GdXJuaXR1cmU6IFwiXG5cbiAgICAgICAgICAgIC8vZnVybml0dXJlIHR5cGVcbiAgICAgICAgICAgIGlmIChhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJmdXJuaXR1cmVcIl1bXCJjb3VudGVydG9wXCJdICYmIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImZ1cm5pdHVyZVwiXVtcImNhYmluZXRcIl0pIHtcbiAgICAgICAgICAgICAgICBpbmZvICs9IFwiQ291bnRlcnRvcCBhbmQgQ2FiaW5ldHMgXCJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wiZnVybml0dXJlXCJdW1wiY2FiaW5ldFwiXSkge1xuICAgICAgICAgICAgICAgIGluZm8gKz0gXCJDYWJpbmV0c1wiXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImZ1cm5pdHVyZVwiXVtcImNvdW50ZXJ0b3BcIl0pIHtcbiAgICAgICAgICAgICAgICBpbmZvICs9IFwiQ291bnRlcnRvcFwiXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vbG9jYXRpb25cbiAgICAgICAgICAgIGluZm8gKz0gXCI8YnIvPkxvY2F0aW9uOiBcIiArIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImxvY2F0aW9uXCJdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wibG9jYXRpb25cIl0uc2xpY2UoMSlcbiAgICAgICAgICAgIC8vbWF0ZXJpYWxcbiAgICAgICAgICAgIGluZm8gKz0gXCI8YnIvPk1hdGVyaWFsOiBcIiArIGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcIm1hdGVyaWFsXCJdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wibWF0ZXJpYWxcIl0uc2xpY2UoMSlcbiAgICAgICAgICAgIC8vcGF0dGVyblxuICAgICAgICAgICAgaW5mbyArPSBcIjxici8+UGF0dGVybjogXCIgKyAoYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wicGF0dGVyblwiXSA/IFwiWWVzXCIgOiBcIk5vbmVcIilcblxuICAgICAgICAgICAgaWYgKHJvdyA9PSBcInJlY29uXCIpIHtcbiAgICAgICAgICAgICAgICBpbmZvICs9IFwiPGJyLz5Fc3RpbWF0ZWQgcmF0aW5nOiBcIiArIGRhdGFbaWRdXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJvdyA9PSBcInJhdGVkXCIpIHtcbiAgICAgICAgICAgICAgICBpbmZvICs9IFwiPGJyLz5Zb3VyIHJhdGluZzogXCIgKyBkYXRhW2lkXVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50Lmluc2VydEFkamFjZW50SFRNTCAoXG4gICAgICAgICAgICAgICAgXCJiZWZvcmVlbmRcIixcbiAgICAgICAgICAgICAgICBcIjxkaXYgY2xhc3M9XFxcImRldGFpbHNcXFwiPjxwPlwiICsgaW5mbyArIFwiPHA+XCJcbiAgICAgICAgICAgIClcbiAgICAgICAgfSlcbiAgICAgICAgY29sdW1uTnVtKytcbiAgICB9XG5cbiAgICBpZiAoT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID09IDApIHtcbiAgICAgICAgaWYgKHJvdyA9PSBcInJlY29uXCIpIHtcbiAgICAgICAgICAgIGxldCBoZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlY29uSGVhZGVyXCIpXG4gICAgICAgICAgICBoZWFkZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKFxuICAgICAgICAgICAgICAgIFwiYWZ0ZXJlbmRcIixcbiAgICAgICAgICAgICAgICBcIjxwIGNsYXNzPVxcXCJub0Rpc3BsYXlcXFwiPkl0IGxvb2tzIGxpa2Ugd2UgY291bGRuJ3QgZ2V0IHlvdSBhIHN1aXRhYmxlIHJlY29tbWVuZGF0aW9uLiBQbGVhc2UgcmF0ZSBtb3JlIGl0ZW1zIG9yIHdhaXQgYXMgdGhlIHByb2dyYW0gY291bGQgc3RpbGwgYmUgcHJvY2Vzc2luZyB5b3VyIHJhdGluZ3MuPC9wPlwiXG4gICAgICAgICAgICApXG4gICAgICAgIH0gZWxzZSBpZiAocm93ID09IFwicmF0ZWRcIikge1xuICAgICAgICAgICAgbGV0IGhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmF0ZWRIZWFkZXJcIilcbiAgICAgICAgICAgIGhlYWRlci5pbnNlcnRBZGphY2VudEhUTUwoXG4gICAgICAgICAgICAgICAgXCJhZnRlcmVuZFwiLFxuICAgICAgICAgICAgICAgIFwiPHAgY2xhc3M9XFxcIm5vRGlzcGxheVxcXCI+SXQgbG9va3MgbGlrZSB5b3UgaGF2ZW4ndCByYXRlZCBhbnl0aGluZyBoaWdobHkgeWV0LiBQbGVhc2UgcmF0ZSBtb3JlIGl0ZW1zLiA8L3A+XCJcbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZXhwYW5kKGtleSkge1xuICAgIGxldCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoa2V5KVxuICAgIGxldCBjb250YWluZXIgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJkZXRhaWxzXCIpWzBdXG4gICAgaWYgKGNvbnRhaW5lci5zdHlsZS5tYXhIZWlnaHQpe1xuICAgICAgICBjb250YWluZXIuc3R5bGUubWF4SGVpZ2h0ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb250YWluZXIuc3R5bGUubWF4SGVpZ2h0ID0gY29udGFpbmVyLnNjcm9sbEhlaWdodCArIFwicHhcIjtcbiAgICB9XG59Il19