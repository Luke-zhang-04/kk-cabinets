"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=!0;var _d=!1;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function(){};return{s:F,n:function n(){if(i>=o.length)return{done:!0};return{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e3){didErr=!0;err=_e3},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var storageRef=storage.ref("gallery");firebase.auth().onAuthStateChanged(function(user){if(user){get_recommendations(user)}});function get_recommendations(user){var recommended=new Map;var rated=new Map;firebase.database().ref("/users/"+user.uid+"/predicted").once("value").then(function(snapshot){var _iterator=_createForOfIteratorHelper(snapshot.val().entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2);index=_step$value[0];elem=_step$value[1];if(!Number.isInteger(elem)&&elem>=5){recommended[index]=elem}else if(Number.isInteger&&elem>=7){rated[index]=elem}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}).then(function(){display_setup(recommended,"recon");display_setup(rated,"rated")}).then(function(){document.getElementById("loading").style.display="none"})}function display_setup(data,config){var allData=new Map;db.collection("gallery").get().then(function(snapshot){snapshot.docs.forEach(function(doc){allData[doc.id]=doc.data()})}).then(function(){display_batch(data,allData,config)})}function display_batch(data,allData,row){var columns=document.getElementById(row).getElementsByClassName("responsive_column");var columnNum=0;var _loop=function(key){var imgURL=storageRef.child(allData[key]["file"]);var column=columns[columnNum%4];var id=key;imgURL.getDownloadURL().then(function(url){column.insertAdjacentHTML("beforeend","<div class=\"image_container\" id="+id+"><img onclick=\"expand("+id+")\"src=\""+url+"\"/></div>");var element=document.getElementById(id);var info="<br/>Colour: "+allData[id]["details"]["colour"].charAt(0).toUpperCase()+allData[id]["details"]["colour"].slice(1)+"<br/>Furniture: ";if(allData[id]["details"]["furniture"]["countertop"]&&allData[id]["details"]["furniture"]["cabinet"]){info+="Countertop and Cabinets "}else if(allData[id]["details"]["furniture"]["cabinet"]){info+="Cabinets"}else if(allData[id]["details"]["furniture"]["countertop"]){info+="Countertop"}info+="<br/>Location: "+allData[id]["details"]["location"].charAt(0).toUpperCase()+allData[id]["details"]["location"].slice(1);info+="<br/>Material: "+allData[id]["details"]["material"].charAt(0).toUpperCase()+allData[id]["details"]["material"].slice(1);info+="<br/>Pattern: "+(allData[id]["details"]["pattern"]?"Yes":"None");if(row=="recon"){info+="<br/>Estimated rating: "+data[id]}else if(row=="rated"){info+="<br/>Your rating: "+data[id]}element.insertAdjacentHTML("beforeend","<div class=\"details\"><p>"+info+"<p>")});columnNum++};for(var key in data){_loop(key)}if(Object.keys(data).length==0){if(row=="recon"){var header=document.getElementById("reconHeader");header.insertAdjacentHTML("afterend","<p class=\"noDisplay\">It looks like we couldn't get you a suitable recommendation. Please rate more items or wait as the program could still be processing your ratings.</p>")}else if(row=="rated"){var _header=document.getElementById("ratedHeader");_header.insertAdjacentHTML("afterend","<p class=\"noDisplay\">It looks like you haven't rated anything highly yet. Please rate more items. </p>")}}}function expand(key){var element=document.getElementById(key);var container=element.getElementsByClassName("details")[0];if(container.style.maxHeight){container.style.maxHeight=null}else{container.style.maxHeight=container.scrollHeight+"px"}}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2pzL3JlY29tbWVuZGF0aW9ucy5qcyJdLCJuYW1lcyI6WyJzdG9yYWdlUmVmIiwic3RvcmFnZSIsInJlZiIsImZpcmViYXNlIiwiYXV0aCIsIm9uQXV0aFN0YXRlQ2hhbmdlZCIsInVzZXIiLCJnZXRfcmVjb21tZW5kYXRpb25zIiwicmVjb21tZW5kZWQiLCJNYXAiLCJyYXRlZCIsImRhdGFiYXNlIiwidWlkIiwib25jZSIsInRoZW4iLCJzbmFwc2hvdCIsInZhbCIsImVudHJpZXMiLCJpbmRleCIsImVsZW0iLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJkaXNwbGF5X3NldHVwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiZGlzcGxheSIsImRhdGEiLCJjb25maWciLCJhbGxEYXRhIiwiZGIiLCJjb2xsZWN0aW9uIiwiZ2V0IiwiZG9jcyIsImZvckVhY2giLCJkb2MiLCJpZCIsImRpc3BsYXlfYmF0Y2giLCJyb3ciLCJjb2x1bW5zIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImNvbHVtbk51bSIsImtleSIsImltZ1VSTCIsImNoaWxkIiwiY29sdW1uIiwiZ2V0RG93bmxvYWRVUkwiLCJ1cmwiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJlbGVtZW50IiwiaW5mbyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiaGVhZGVyIiwiZXhwYW5kIiwiY29udGFpbmVyIiwibWF4SGVpZ2h0Iiwic2Nyb2xsSGVpZ2h0Il0sIm1hcHBpbmdzIjoiNG5FQXFCQSxHQUFJQSxDQUFBQSxVQUFVLENBQUdDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFNBQVosQ0FBakIsQ0FHQUMsUUFBUSxDQUFDQyxJQUFULEdBQWdCQyxrQkFBaEIsQ0FBbUMsU0FBU0MsSUFBVCxDQUFlLENBQzlDLEdBQUlBLElBQUosQ0FBVSxDQUNOQyxtQkFBbUIsQ0FBQ0QsSUFBRCxDQUN0QixDQUdKLENBTkQsRUFRQSxR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VUFESixDQUVJLDBHQUZKLENBSUgsQ0FDSixDQUNKLENBRUQsUUFBU1UsQ0FBQUEsTUFBVCxDQUFnQmhCLEdBQWhCLENBQXFCLENBQ2pCLEdBQUlPLENBQUFBLE9BQU8sQ0FBRzFCLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QmtCLEdBQXhCLENBQWQsQ0FDQSxHQUFJaUIsQ0FBQUEsU0FBUyxDQUFHVixPQUFPLENBQUNULHNCQUFSLENBQStCLFNBQS9CLEVBQTBDLENBQTFDLENBQWhCLENBQ0EsR0FBSW1CLFNBQVMsQ0FBQ2xDLEtBQVYsQ0FBZ0JtQyxTQUFwQixDQUE4QixDQUMxQkQsU0FBUyxDQUFDbEMsS0FBVixDQUFnQm1DLFNBQWhCLENBQTRCLElBQy9CLENBRkQsSUFFTyxDQUNIRCxTQUFTLENBQUNsQyxLQUFWLENBQWdCbUMsU0FBaEIsQ0FBNEJELFNBQVMsQ0FBQ0UsWUFBVixDQUF5QixJQUN4RCxDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLypcblx0S0sgQ2FiaW5ldHNcbiAgICBDb3B5cmlnaHQgKEMpIDIwMjAgIEx1a2UgWmhhbmcsIEV0aGFuIExpbVxuICAgIFxuICAgIGh0dHBzOi8vbHVrZS16aGFuZy0wNC5naXRodWIuaW9cbiAgICBodHRwczovL2dpdGh1Yi5jb20vZXRoYW5saW0wNFxuXG4gICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuKi9cblxubGV0IHN0b3JhZ2VSZWYgPSBzdG9yYWdlLnJlZihcImdhbGxlcnlcIilcblxuLy9hdXRoIHN0YXRlIGNoYW5nZWRcbmZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQoZnVuY3Rpb24odXNlcikge1xuICAgIGlmICh1c2VyKSB7XG4gICAgICAgIGdldF9yZWNvbW1lbmRhdGlvbnModXNlcilcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBObyB1c2VyIGlzIHNpZ25lZCBpbi5cbiAgICB9XG59KVxuXG5mdW5jdGlvbiBnZXRfcmVjb21tZW5kYXRpb25zKHVzZXIpIHtcbiAgICBsZXQgcmVjb21tZW5kZWQgPSBuZXcgTWFwKClcbiAgICBsZXQgcmF0ZWQgPSBuZXcgTWFwKClcbiAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZihcIi91c2Vycy9cIiArIHVzZXIudWlkICsgXCIvcHJlZGljdGVkXCIpLm9uY2UoXCJ2YWx1ZVwiKS50aGVuKGZ1bmN0aW9uKHNuYXBzaG90KSB7XG4gICAgICAgIGZvciAoW2luZGV4LCBlbGVtXSBvZiBzbmFwc2hvdC52YWwoKS5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihlbGVtKSAmJiBlbGVtID49IDUpIHtcbiAgICAgICAgICAgICAgICByZWNvbW1lbmRlZFtpbmRleF0gPSBlbGVtXG4gICAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIgJiYgZWxlbSA+PSA3KSB7XG4gICAgICAgICAgICAgICAgcmF0ZWRbaW5kZXhdID0gZWxlbVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSkudGhlbihfID0+IHtcbiAgICAgICAgZGlzcGxheV9zZXR1cChyZWNvbW1lbmRlZCwgXCJyZWNvblwiKVxuICAgICAgICBkaXNwbGF5X3NldHVwKHJhdGVkLCBcInJhdGVkXCIpXG4gICAgfSkgLnRoZW4oXyA9PiB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9hZGluZ1wiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCJcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBkaXNwbGF5X3NldHVwKGRhdGEsIGNvbmZpZykge1xuICAgIGxldCBhbGxEYXRhID0gbmV3IE1hcCgpXG4gICAgZGIuY29sbGVjdGlvbihcImdhbGxlcnlcIikuZ2V0KCkudGhlbigoc25hcHNob3QpID0+IHtcbiAgICAgICAgc25hcHNob3QuZG9jcy5mb3JFYWNoKGRvYyA9PiB7XG4gICAgICAgICAgICBhbGxEYXRhW2RvYy5pZF0gPSBkb2MuZGF0YSgpXG4gICAgICAgIH0pXG4gICAgfSkudGhlbihfID0+IHtcbiAgICAgICAgZGlzcGxheV9iYXRjaChkYXRhLCBhbGxEYXRhLCBjb25maWcpXG4gICAgfSlcbn1cblxuZnVuY3Rpb24gZGlzcGxheV9iYXRjaChkYXRhLCBhbGxEYXRhLCByb3cpIHtcbiAgICBsZXQgY29sdW1ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvdykuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInJlc3BvbnNpdmVfY29sdW1uXCIpXG4gICAgbGV0IGNvbHVtbk51bSA9IDBcblxuICAgIGZvciAobGV0IGtleSBpbiBkYXRhKSB7XG4gICAgICAgIGxldCBpbWdVUkwgPSBzdG9yYWdlUmVmLmNoaWxkKGFsbERhdGFba2V5XVtcImZpbGVcIl0pIC8vaW1hZ2UgdXJsXG4gICAgICAgIGxldCBjb2x1bW4gPSBjb2x1bW5zW2NvbHVtbk51bSU0XVxuICAgICAgICBsZXQgaWQgPSBrZXlcblxuICAgICAgICBpbWdVUkwuZ2V0RG93bmxvYWRVUkwoKS50aGVuKGZ1bmN0aW9uKHVybCkge1xuICAgICAgICAgICAgLy9hcHBlbmQgaW1hZ2UgdG8gY29sdW1uXG4gICAgICAgICAgICBjb2x1bW4uaW5zZXJ0QWRqYWNlbnRIVE1MICggXG4gICAgICAgICAgICAgICAgXCJiZWZvcmVlbmRcIixcbiAgICAgICAgICAgICAgICBcIjxkaXYgY2xhc3M9XFxcImltYWdlX2NvbnRhaW5lclxcXCIgaWQ9XCIgKyBpZCArIFwiPjxpbWcgb25jbGljaz1cXFwiZXhwYW5kKFwiICsgaWQgKyBcIilcXFwic3JjPVxcXCJcIisgdXJsICsgXCJcXFwiLz48L2Rpdj5cIlxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAvL2F0dGFjaCBpbmZvcm1hdGlvbiB0byBpbWFnZVxuICAgICAgICAgICAgbGV0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkgLy9zaG9ydGN1dCBmb3IgdGFyZ2V0IGVsZW1lbnRcbiAgICAgICAgICAgIC8vdmFyaWFibGUgZm9yIGluZm9ybWF0aW9uXG4gICAgICAgICAgICBsZXQgaW5mbyA9IFwiPGJyLz5Db2xvdXI6IFwiICsgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wiY29sb3VyXCJdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wiY29sb3VyXCJdLnNsaWNlKDEpICsgXCI8YnIvPkZ1cm5pdHVyZTogXCJcblxuICAgICAgICAgICAgLy9mdXJuaXR1cmUgdHlwZVxuICAgICAgICAgICAgaWYgKGFsbERhdGFbaWRdW1wiZGV0YWlsc1wiXVtcImZ1cm5pdHVyZVwiXVtcImNvdW50ZXJ0b3BcIl0gJiYgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wiZnVybml0dXJlXCJdW1wiY2FiaW5ldFwiXSkge1xuICAgICAgICAgICAgICAgIGluZm8gKz0gXCJDb3VudGVydG9wIGFuZCBDYWJpbmV0cyBcIlxuICAgICAgICAgICAgfSBlbHNlIGlmIChhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJmdXJuaXR1cmVcIl1bXCJjYWJpbmV0XCJdKSB7XG4gICAgICAgICAgICAgICAgaW5mbyArPSBcIkNhYmluZXRzXCJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wiZnVybml0dXJlXCJdW1wiY291bnRlcnRvcFwiXSkge1xuICAgICAgICAgICAgICAgIGluZm8gKz0gXCJDb3VudGVydG9wXCJcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9sb2NhdGlvblxuICAgICAgICAgICAgaW5mbyArPSBcIjxici8+TG9jYXRpb246IFwiICsgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wibG9jYXRpb25cIl0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJsb2NhdGlvblwiXS5zbGljZSgxKVxuICAgICAgICAgICAgLy9tYXRlcmlhbFxuICAgICAgICAgICAgaW5mbyArPSBcIjxici8+TWF0ZXJpYWw6IFwiICsgYWxsRGF0YVtpZF1bXCJkZXRhaWxzXCJdW1wibWF0ZXJpYWxcIl0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJtYXRlcmlhbFwiXS5zbGljZSgxKVxuICAgICAgICAgICAgLy9wYXR0ZXJuXG4gICAgICAgICAgICBpbmZvICs9IFwiPGJyLz5QYXR0ZXJuOiBcIiArIChhbGxEYXRhW2lkXVtcImRldGFpbHNcIl1bXCJwYXR0ZXJuXCJdID8gXCJZZXNcIiA6IFwiTm9uZVwiKVxuXG4gICAgICAgICAgICBpZiAocm93ID09IFwicmVjb25cIikge1xuICAgICAgICAgICAgICAgIGluZm8gKz0gXCI8YnIvPkVzdGltYXRlZCByYXRpbmc6IFwiICsgZGF0YVtpZF1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocm93ID09IFwicmF0ZWRcIikge1xuICAgICAgICAgICAgICAgIGluZm8gKz0gXCI8YnIvPllvdXIgcmF0aW5nOiBcIiArIGRhdGFbaWRdXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MIChcbiAgICAgICAgICAgICAgICBcImJlZm9yZWVuZFwiLFxuICAgICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz1cXFwiZGV0YWlsc1xcXCI+PHA+XCIgKyBpbmZvICsgXCI8cD5cIlxuICAgICAgICAgICAgKVxuICAgICAgICB9KVxuICAgICAgICBjb2x1bW5OdW0rK1xuICAgIH1cblxuICAgIGlmIChPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPT0gMCkge1xuICAgICAgICBpZiAocm93ID09IFwicmVjb25cIikge1xuICAgICAgICAgICAgbGV0IGhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVjb25IZWFkZXJcIilcbiAgICAgICAgICAgIGhlYWRlci5pbnNlcnRBZGphY2VudEhUTUwoXG4gICAgICAgICAgICAgICAgXCJhZnRlcmVuZFwiLFxuICAgICAgICAgICAgICAgIFwiPHAgY2xhc3M9XFxcIm5vRGlzcGxheVxcXCI+SXQgbG9va3MgbGlrZSB3ZSBjb3VsZG4ndCBnZXQgeW91IGEgc3VpdGFibGUgcmVjb21tZW5kYXRpb24uIFBsZWFzZSByYXRlIG1vcmUgaXRlbXMgb3Igd2FpdCBhcyB0aGUgcHJvZ3JhbSBjb3VsZCBzdGlsbCBiZSBwcm9jZXNzaW5nIHlvdXIgcmF0aW5ncy48L3A+XCJcbiAgICAgICAgICAgIClcbiAgICAgICAgfSBlbHNlIGlmIChyb3cgPT0gXCJyYXRlZFwiKSB7XG4gICAgICAgICAgICBsZXQgaGVhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYXRlZEhlYWRlclwiKVxuICAgICAgICAgICAgaGVhZGVyLmluc2VydEFkamFjZW50SFRNTChcbiAgICAgICAgICAgICAgICBcImFmdGVyZW5kXCIsXG4gICAgICAgICAgICAgICAgXCI8cCBjbGFzcz1cXFwibm9EaXNwbGF5XFxcIj5JdCBsb29rcyBsaWtlIHlvdSBoYXZlbid0IHJhdGVkIGFueXRoaW5nIGhpZ2hseSB5ZXQuIFBsZWFzZSByYXRlIG1vcmUgaXRlbXMuIDwvcD5cIlxuICAgICAgICAgICAgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBleHBhbmQoa2V5KSB7XG4gICAgbGV0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChrZXkpXG4gICAgbGV0IGNvbnRhaW5lciA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImRldGFpbHNcIilbMF1cbiAgICBpZiAoY29udGFpbmVyLnN0eWxlLm1heEhlaWdodCl7XG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5tYXhIZWlnaHQgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5tYXhIZWlnaHQgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xuICAgIH1cbn0iXX0=